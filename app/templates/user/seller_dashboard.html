<!DOCTYPE html>
<html lang="vi">
<head>
    <title>C·ª≠a h√†ng c·ªßa t√¥i - Ch·ª£ ƒê·ªì C≈©</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            display: flex;
            min-height: 100vh;
        }
        /* ---------------------------------- */
        /* Thanh Sidebar */
        /* ---------------------------------- */
        .sidebar {
            width: 250px;
            background-color: #34495e; /* M√†u n·ªÅn t·ªëi h∆°n, chuy√™n nghi·ªáp h∆°n */
            color: white;
            padding-top: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: fixed;
            height: 100%;
            overflow-y: auto;
        }
        .sidebar a {
            padding: 15px 20px;
            text-decoration: none;
            font-size: 16px;
            color: #ecf0f1;
            display: block;
            transition: background-color 0.3s;
            border-left: 5px solid transparent;
        }
        .sidebar a:hover, .sidebar a.active {
            background-color: #4f6f8f; /* M√†u hover nh·∫π */
            border-left: 5px solid #f39c12; /* M√†u cam n·ªïi b·∫≠t (th∆∞∆°ng hi·ªáu) */
            color: white;
        }
        .sidebar h3 {
            text-align: center;
            margin-bottom: 30px;
            color: #f39c12; /* M√†u ti√™u ƒë·ªÅ cam */
            padding: 0 20px;
            font-size: 1.5em;
        }
        .sidebar a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        /* ---------------------------------- */
        /* Ph·∫ßn Header v√† N·ªôi dung ch√≠nh */
        /* ---------------------------------- */
        .main-content {
            margin-left: 250px;
            flex-grow: 1;
            padding: 20px;
        }
        .header-bar {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 5px;
        }
        .header-bar h2 {
            margin: 0;
            color: #333;
        }
        /* ---------------------------------- */
        /* Box ch·ª©c nƒÉng ch√≠nh */
        /* ---------------------------------- */
        .function-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        /* Table Products */
        .product-table th {
            background-color: #e6e6e6;
        }
        /* N√∫t T√¨nh tr·∫°ng & C·∫≠p nh·∫≠t (Ch∆∞a x·ª≠ l√Ω ch·ª©c nƒÉng) */
        .action-button {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3><i class="fas fa-warehouse"></i> C·ª≠a h√†ng c·ªßa t√¥i</h3>
        <div style="padding: 10px 0;">
            <a href="#" class="active" data-content="dashboard"><i class="fas fa-chart-line"></i> B·∫£ng ƒëi·ªÅu khi·ªÉn</a>
            <h4 style="color: #bdc3c7; font-size: 0.9em; padding: 10px 20px 5px;">Qu·∫£n l√Ω B√°n h√†ng</h4>
            <a href="#" data-content="create-product"><i class="fas fa-plus-circle"></i> **ƒêƒÉng b√°n S·∫£n ph·∫©m**</a>
            <a href="#" data-content="manage-products"><i class="fas fa-box"></i> Qu·∫£n l√Ω S·∫£n ph·∫©m</a>
            <a href="#" data-content="manage-orders"><i class="fas fa-file-invoice-dollar"></i> Qu·∫£n l√Ω ƒê∆°n h√†ng</a>
            <h4 style="color: #bdc3c7; font-size: 0.9em; padding: 10px 20px 5px;">T√†i kho·∫£n</h4>
            <a href="/profile"><i class="fas fa-user-circle"></i> H·ªì s∆° c√° nh√¢n</a>
            <a href="#" id="logoutButton"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng Xu·∫•t</a>
        </div>
    </div>

    <div class="main-content">
        <div class="header-bar">
            <h2 id="currentTitle">B·∫£ng ƒëi·ªÅu khi·ªÉn</h2>
            <div id="sellerName">Xin ch√†o, Ng∆∞·ªùi b√°n</div>
        </div>

        <div id="dashboard-content" class="content-area">
            <h3>üìä Th·ªëng k√™ nhanh</h3>
            <div class="d-flex gap-3 mb-4">
                <div class="p-3 bg-primary text-white rounded shadow-sm flex-grow-1">
                    <div class="h4">0</div><small>S·∫£n ph·∫©m ƒëang ch·ªù duy·ªát</small>
                </div>
                <div class="p-3 bg-success text-white rounded shadow-sm flex-grow-1">
                    <div class="h4">0</div><small>ƒê∆°n h√†ng m·ªõi ch·ªù x·ª≠ l√Ω</small>
                </div>
                <div class="p-3 bg-warning text-dark rounded shadow-sm flex-grow-1">
                    <div class="h4">0</div><small>T·ªïng s·∫£n ph·∫©m ƒëang b√°n</small>
                </div>
            </div>
            <div class="function-card">
                <h4>Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h4>
                <p>N∆°i hi·ªÉn th·ªã c√°c ƒë∆°n h√†ng/c·∫≠p nh·∫≠t s·∫£n ph·∫©m g·∫ßn nh·∫•t...</p>
            </div>
        </div>

        <div id="create-product-content" class="content-area" style="display: none;">
            <div class="function-card">
                <h4><i class="fas fa-plus-circle me-2"></i> ƒêƒÉng B√°n S·∫£n Ph·∫©m M·ªõi</h4>
                <form id="sellForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">T√™n S·∫£n Ph·∫©m:</label>
                        <input type="text" class="form-control" id="title" name="title" required placeholder="V√≠ d·ª•: Xe ƒë·∫°p ƒë·ªãa h√¨nh c≈©">
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="category" class="form-label">Danh M·ª•c:</label>
                            <select id="category" class="form-select" name="category_id" required>
                                <option value="">-- Ch·ªçn danh m·ª•c --</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="price" class="form-label">Gi√° B√°n (VNƒê):</label>
                            <input type="number" step="0.01" class="form-control" id="price" name="price" required min="1000" placeholder="500000">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="quantity" class="form-label">S·ªë l∆∞·ª£ng:</label>
                            <input type="number" class="form-control" id="quantity" name="quantity" required min="1" value="1">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="videoUrl" class="form-label">Video URL (T√πy ch·ªçn):</label>
                            <input type="url" class="form-control" id="videoUrl" name="video_url" placeholder="https://youtube.com/video.mp4">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="productImages" class="form-label">·∫¢nh S·∫£n Ph·∫©m (T·ªëi ƒëa 3 ·∫£nh):</label>
                        <input class="form-control" type="file" id="productImages" name="files" multiple accept="image/*" required>
                        <div class="form-text text-danger">B·∫Øt bu·ªôc ph·∫£i c√≥ √≠t nh·∫•t 1 ·∫£nh.</div>
                    </div>
                    <div class="mb-3">
                        <label for="desc" class="form-label">M√¥ T·∫£ Chi Ti·∫øt:</label>
                        <textarea id="desc" class="form-control" rows="4" name="description" placeholder="T√¨nh tr·∫°ng, l√Ω do b√°n, ∆∞u nh∆∞·ª£c ƒëi·ªÉm..."></textarea>
                    </div>
                    <div id="sellResult" class="mt-3 p-2 rounded text-center d-none"></div>
                    <button type="submit" class="btn btn-primary w-100 mt-3"><i class="fas fa-upload me-2"></i> ƒêƒÉng B√°n S·∫£n Ph·∫©m</button>
                </form>
            </div>
        </div>

        <div id="manage-products-content" class="content-area" style="display: none;">
            <div class="function-card">
                <h4><i class="fas fa-list-alt me-2"></i> Danh s√°ch S·∫£n ph·∫©m c·ªßa t√¥i</h4>
                <div class="mb-3">
                    <select class="form-select w-auto d-inline-block" id="productStatusFilter">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="pending">Ch·ªù duy·ªát (Pending)</option>
                        <option value="approved">ƒêang b√°n (Approved)</option>
                        <option value="rejected">B·ªã t·ª´ ch·ªëi (Rejected)</option>
                    </select>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover product-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√™n S·∫£n ph·∫©m</th>
                                <th>Gi√°</th>
                                <th>S·ªë l∆∞·ª£ng</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
                            <tr>
                                <td>101</td>
                                <td>B√†n ph√≠m c∆° c≈© Razer</td>
                                <td>500,000</td>
                                <td>1</td>
                                <td><span class="badge bg-warning">Ch·ªù duy·ªát</span></td>
                                <td>
                                    <button class="btn btn-sm btn-info action-button">Xem</button>
                                    <button class="btn btn-sm btn-primary action-button" disabled>C·∫≠p nh·∫≠t</button>
                                </td>
                            </tr>
                            <tr>
                                <td>102</td>
                                <td>Gh·∫ø xoay vƒÉn ph√≤ng</td>
                                <td>800,000</td>
                                <td>3</td>
                                <td><span class="badge bg-success">ƒêang b√°n</span></td>
                                <td>
                                    <button class="btn btn-sm btn-info action-button">Xem</button>
                                    <button class="btn btn-sm btn-primary action-button">C·∫≠p nh·∫≠t</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="manage-orders-content" class="content-area" style="display: none;">
            <div class="function-card">
                <h4><i class="fas fa-file-invoice-dollar me-2"></i> Qu·∫£n l√Ω ƒê∆°n h√†ng (B√°n)</h4>
                <p>N∆°i li·ªát k√™ c√°c ƒë∆°n h√†ng ng∆∞·ªùi mua ƒë√£ ƒë·∫∑t t·ª´ c·ª≠a h√†ng c·ªßa b·∫°n. (Ch·ª©c nƒÉng ch∆∞a x·ª≠ l√Ω)</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const apiBase = "http://127.0.0.1:8000/api/v1";

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o
        function displayMessage(message, type = 'info') {
            const messageBox = document.getElementById('sellResult');
            if (!messageBox) return;

            messageBox.classList.remove('d-none', 'alert-success', 'alert-danger', 'alert-info');
            messageBox.classList.add('d-block');
            messageBox.textContent = message;

            if (type === 'error') {
                messageBox.classList.add('alert-danger');
            } else if (type === 'success') {
                messageBox.classList.add('alert-success');
            } else {
                messageBox.classList.add('alert-info');
            }

            // T·ª± ƒë·ªông ·∫©n sau 5 gi√¢y
            setTimeout(() => {
                messageBox.classList.add('d-none');
            }, 5000);
        }

        // --- 1. Qu·∫£n l√Ω Chuy·ªÉn ƒë·ªïi n·ªôi dung ---
        const contentAreas = document.querySelectorAll('.content-area');
        const sidebarLinks = document.querySelectorAll('.sidebar a[data-content]');
        const currentTitle = document.getElementById('currentTitle');

        function showContent(contentId) {
            contentAreas.forEach(area => area.style.display = 'none');
            const targetArea = document.getElementById(contentId + '-content');
            
            if (targetArea) {
                targetArea.style.display = 'block';
                const link = document.querySelector(`.sidebar a[data-content="${contentId}"]`);
                currentTitle.textContent = link ? link.textContent.trim() : 'B·∫£ng ƒëi·ªÅu khi·ªÉn';
            }

            sidebarLinks.forEach(link => link.classList.remove('active'));
            const activeLink = document.querySelector(`.sidebar a[data-content="${contentId}"]`);
            if (activeLink) activeLink.classList.add('active');

            if (contentId === 'create-product') {
                loadCategories();
            }
        }

        sidebarLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const contentId = e.currentTarget.getAttribute('data-content');
                showContent(contentId);
            });
        });

        // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã Dashboard khi load
        showContent('dashboard');

        // --- 2. X·ª≠ l√Ω ƒêƒÉng xu·∫•t ---
        document.getElementById('logoutButton').addEventListener('click', () => {
            localStorage.removeItem('access_token');
            localStorage.removeItem('user_name'); 
            displayMessage('B·∫°n ƒë√£ ƒëƒÉng xu·∫•t kh·ªèi c·ª≠a h√†ng.', 'info');
            setTimeout(() => {
                window.location.href = "/";
            }, 1500);
        });

        // --- 3. Logic T·∫£i Danh m·ª•c ---
        async function loadCategories() {
            try {
                const select = document.getElementById("category");
                // Ki·ªÉm tra n·∫øu danh m·ª•c ƒë√£ ƒë∆∞·ª£c load r·ªìi th√¨ kh√¥ng load l·∫°i
                if (select.options.length > 1) return; 

                const res = await fetch(`${apiBase}/categories/`);
                if (!res.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i danh m·ª•c");
                
                const data = await res.json();
                select.innerHTML = '<option value="">-- Ch·ªçn danh m·ª•c --</option>';
                
                data.forEach(cat => {
                    const opt = document.createElement("option");
                    opt.value = cat.CategoryID;
                    opt.textContent = cat.CategoryName;
                    select.appendChild(opt);
                });
            } catch (err) {
                console.error("L·ªói t·∫£i danh m·ª•c:", err);
                displayMessage("‚ö†Ô∏è L·ªói t·∫£i danh m·ª•c! Vui l√≤ng th·ª≠ l·∫°i.", 'error');
            }
        }

        // --- 4. Logic X·ª≠ l√Ω G·ª≠i Form ƒêƒÉng b√°n (ƒê√É S·ª¨A) ---
        async function handleProductSubmission(event) {
            event.preventDefault();
            
            // D√πng event.target ƒë·ªÉ l·∫•y form
            const form = event.target; 
            const productImages = document.getElementById("productImages").files;
            const submitButton = form.querySelector('button[type="submit"]');

            // 1. Ki·ªÉm tra ·∫£nh
            if (productImages.length === 0 || productImages.length > 3) {
                displayMessage("‚ùå Vui l√≤ng ch·ªçn t·ª´ 1 ƒë·∫øn 3 ·∫£nh.", 'error');
                return;
            }

            // 2. L·∫•y token
            const token = localStorage.getItem('access_token');
            if (!token) {
                displayMessage("‚ùå L·ªói x√°c th·ª±c: Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.", "error");
                return;
            }

            // 3. Chu·∫©n b·ªã FormData (D·ªØ li·ªáu form ƒë∆∞·ª£c thu th·∫≠p t·ª± ƒë·ªông nh·ªù thu·ªôc t√≠nh name)
            const formData = new FormData(form); 

            // 4. G·ª≠i Request
            try {
                submitButton.disabled = true;
                submitButton.textContent = 'ƒêang t·∫£i l√™n...';
                displayMessage('ƒêang t·∫£i l√™n s·∫£n ph·∫©m...', 'info');

                const res = await fetch(`${apiBase}/products/upload/`, {
                    method: "POST",
                    headers: {
                        "Authorization": "Bearer " + token
                    },
                    body: formData
                });

                const data = await res.json();
                
                if (res.ok) {
                    displayMessage(`‚úÖ S·∫£n ph·∫©m "${data.Title}" ƒë√£ ƒë∆∞·ª£c ƒëƒÉng! Vui l√≤ng ch·ªù ki·ªÉm duy·ªát.`, 'success');
                    form.reset(); // ƒê·∫∑t l·∫°i form sau khi ƒëƒÉng th√†nh c√¥ng
                } else if (res.status === 401) {
                    displayMessage("‚ùå L·ªói ƒëƒÉng s·∫£n ph·∫©m: Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i. (Token kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n)", "error");
                } else {
                    let detail = data.detail || JSON.stringify(data);
                    displayMessage(`‚ùå L·ªói [${res.status}]: ${detail}`, "error");
                }
            } catch (err) {
                console.error('L·ªói m·∫°ng ho·∫∑c fetch:', err);
                displayMessage("‚ùå L·ªói k·∫øt n·ªëi m·∫°ng ƒë·∫øn Server.", "error");
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'ƒêƒÉng B√°n S·∫£n Ph·∫©m';
            }
        }

        // --- G·∫Øn s·ª± ki·ªán cho form (ƒê√É S·ª¨A ID FORM) ---
        document.addEventListener('DOMContentLoaded', () => {
            // S·ª¨A L·ªñI: D√πng ID 'sellForm'
            const form = document.getElementById('sellForm');
            if (form) {
                form.addEventListener('submit', handleProductSubmission);
            }
        });

        // --- 5. Logic T·∫£i s·∫£n ph·∫©m (Ch∆∞a x·ª≠ l√Ω) ---
        async function loadSellerProducts() {
            // S·∫Ω c·∫ßn m·ªôt API endpoint nh∆∞ /api/v1/products/seller ƒë·ªÉ l·∫•y danh s√°ch s·∫£n ph·∫©m c·ªßa ng∆∞·ªùi b√°n.
            console.log("ƒêang t·∫£i danh s√°ch s·∫£n ph·∫©m...");
            // V√≠ d·ª•: const token = localStorage.getItem('access_token');
            // const res = await fetch(`${apiBase}/products/seller?status=${statusFilter}`, {headers: {'Authorization': `Bearer ${token}`}});
        }

        // --- 6. Hi·ªÉn th·ªã t√™n ng∆∞·ªùi b√°n ---
        const storedUserName = localStorage.getItem('user_name');
        if (storedUserName) {
            document.getElementById('sellerName').innerHTML = `<i class="fas fa-user-circle me-2"></i> ${storedUserName}`;
        }
    </script>
</body>
</html>